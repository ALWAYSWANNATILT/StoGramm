<% if user_signed_in? %>
  <div class="form-upload">
    <%= form_for Post.new do |f| %>
      <div class="form-group">
        <%= f.text_field :description %>
      </div>
      <div class="form-group">
        <%= f.file_field :image %>
      </div>
      <div class="form-group">
        <%= f.text_field :user_id, value: current_user.id, class:'d-none'%>
      </div>
      <br>
      <div class="text-center">
        <%= f.submit 'Create Post', class: 'btn btn-primary' %>
      </div>
    <% end %>
  </div>
  <div class="posts">
    <% @posts.each do |post| %>
      <% if current_user.following?(post.user) || current_user%>
        <section class="post">
          <div class="user">
            <div class="avatar">
              <% if post.user.avatar.attached? %>
                <%= link_to user_path(post.user) do %>
                  <%= image_tag post.user.avatar %>
                <% end %>
              <% end %>
            </div>
            <%= link_to post.user.username, user_path(post.user), class: 'username' %>
          </div>
          <%= image_tag post.image, class: 'main-image' %>
          <div class="description">
            <%= post.description %>
          </div>
  <% @comments = post.comments.page(params[:page]).per(3) %>
          <% if @comments.count >= 1 %>
            <div class="comments">
              <% @comments.each do |comment| %>
                <div class="comment">
                  <strong><%= comment.username %></strong> <%= comment.content %>
                </div>
              <% end %>
              <% if @comments.count == 3 %>
                <%= link_to "All comments...", post_path(post) %>
              <% end %>
            </div>
          <% end %>
          <div class="add-comment">
            <%= form_for Comment.new do |f| %>
              <%= f.text_field :content, placeholder: "Add a comment..." %>
              <%= f.submit 'Send', class: 'btn btn-comment' %>
              <%= f.text_field :post_id, value: post.id, class:'d-none'%>
              <%= f.text_field :username, value: current_user.username, class:'d-none'%>
            <% end %>
          </div>
        </section>
      <%end %>
    <% end %>

    <%= paginate @posts %>
  </div>
<% end %>

